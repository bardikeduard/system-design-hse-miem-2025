# Полученная система:

## Going Going Gone!

An auction company wants to take their auctions online to a nationwide scale--customers choose the auction to participate in, wait until the auction begins, then bid as if they were there in the room, with the auctioneer

Requirements: auctions must be categorized and "discoverable"; auctions must be real-time; auctions must be mixed live and online; video stream of the action; money exchange; participants must be tracked (reputation); scale up to hundreds of participants (per auction), potentially up to thousands of participants, and as many simultaneous auctions as possible

---

## 1. Отсев

**Что будет, если не реализовать систему?**
* компания не сможет расширить охват аукционов на всю страну
* потеря потенциальных клиентов, предпочитающих онлайн-формат, или проживающих далеко от места проведения аукциона (особенно актуально в нашей стране)
* не получится масштабировать аукционы, если все они будут проходить оффлайн - физически может не хватить места вместить всех участников

**Метрики**
* количество зарегистрированных пользователе. скорее всего нас будет интересовать прирост числа активных пользователей
* количество активных аукционов в день/неделю. тоже можно оценивать показатель в динамике
* финансовый оборот через платформу. важно, т.к. скорее всего этот показатель будет напрямую влиять на объёмы монетизации
* SLA
* конверсия из просмотра аукциона в ставку. на этот показатель будут влиять и наши показатели (условно, UI/UX, latency), так и содержимое платформы (если все аукционы будут неинтересными, то конверсия будет минимальной)

**Приоритеты:**

* **Обязательные, из условия:**
  * система профилей пользователей с их репутацией и историей участия в аукционах
  * создание и категоризация аукционов
  * поиск и обнаружение интересных аукционов
  * приём ставок аукциона в реальном времени
  * видеостриминг аукциона
  * оплаты/выплаты участникам
  * поддержка смешанного формата (ирл и онлайн)
* **Желательные:**
  * интеграция с государственными системами для подтверждения профиля участника аукциона (в целом, нам это врядли понадобится, но регуляторы могут заставить)
  * возможность настройки уведомлений по категориям/ключевым словам и событиям
  * рекомендательные системы аукционов - предлагать наиболее интересные
  * мобильное приложение
  * предсказание цены на основе какой-нибудь модели

---

## 2. Scope Refinement

* **Пользователи:**
  * покупатель
  * продавец
  * организатор (тут возможно несколько акторов, например, бухгалтер, ведущий аукциона, специалист по логистике)

* добавление аукционов, просмотр аукционов по каким-то интересующим фильтрам/ключевым словам, пополнение/вывод баланса, размещение ставок, просмотр истории ставок, просмотр хода аукциона в реальном времени (в том числе видеотрансляция), отслеживание доставки в случае выигрыша, просмотр репутации стартера аукциона, других участников, получение уведомлений о ходе аукциона

---

## 3. Функциональные требования

**Покупатели:**
* регистрация и вход в систему (через email/пароль, возможно какие-нибудь госуслуги/ЭЦП)
* просмотр списка активных и предстоящих аукционов
* поиск аукционов по категориям, ключевым словам
* просмотр деталей аукциона (описание, лоты, текущая ставка, время начала/окончания)
* просмотр видеотрансляции аукциона
* размещение ставок
* получение уведомлений о статусе ставки (принята, перебита)
* просмотр истории своих ставок и выигранных лотов
* пополнение счета и вывод средств
* просмотр своей репутации

**Покупатели:**  
Те же, что и у покупателей +:
* размещение аукционов
* запуск после прохождения модерации

**Организаторы:**
* управление аукционами
* запуск/остановка видеотрансляции
* модерация аукционов
* фиксация ставок от участников в зале для отображения онлайн

---

## 4. Нефункциональные требования

* **Производительность:**
  * задержка приема и отображения ставки: < 500 мс
  * задержка видеотрансляции: < 2 секунд
  * время загрузки страницы каталога аукционов: < 2 секунд
  * характер нагрузки: скорее всего, будут какие-то пики нагрузки во время интересных предложений
* **Масштабируемость:**
  * поддержка до 10000 одновременных участников на одном аукционе
  * возможность горизонтального масштабирования для работы в режиме с пиковой нагрузкой, множества одновременных аукционов и/или пользователей
* **Отказоустойчивость:**
  * SLA: 99.9%
  * high availability ключевых сервисов (ставки, видео)
* **Безопасность:**
  * безопасная обработка платежей (возможно, через сертифицированного провайдера)
  * шифрование передаваемых данных (HTTPS)
  * двухфакторка/ЭЦП для пользователей
  * соответствие гос. стандартам в сфере защиты информации
* **Мониторинг:**
  * сбор метрик с нагруженных сервисов, настройка автоматического масштабирования при повышении нагрузки
  * алертинг при повышении основых параметров (задержки)
* **Регуляторные требования:**
  * интеграция с государственными сервисами
  * хранение действий пользователей в холодном режиме в течение какого-то времени
* **Переносимость:**
  * вероятно, использование микросервисной архитектуры для упрощения масштабирования

---

## 5. Ограничения

* **География и регуляторные требования:**
  * соблюдение 152-ФЗ - хранение и обработка ПД граждан РФ на территории РФ, поэтому либо развёртывание on-premise (очень дорого), либо использование российских облачных провайдеров
  * возможная необходимость интеграции с ЕСИА для аутентификации
  * соблюдение законодательства о проведении аукционов и финансовых операциях в РФ
  * необходимо учитывать распределение пользователей по большой площади страны
* **Технологические:**
  * требуется решение для видеостриминга с низкой задержкой
  * требуется механизм для обмена сообщениями в реальном времени
  * БД должна поддерживать как транзакционные операции, так и быстрый поиск/фильтрацию
  * так как поиск и вывод аукционов будет происходить часто, необходимо кэширование статики
  * БД и кэширование необходимо распределить по разным географическим зонам - вероятно, пользователи будут распределены по стране, распределение позволит уменьшить задержку. Но приведёт к трудностям в реализации
* **Бизнес:**
  * необходимость интеграции онлайн и оффлайн участников в рамках одного аукциона
  * система репутации для предотвращения мошенничества

---

## 6. Расчет нагрузки

**Входные данные (предполагаю):**
* пиковое количество одновременных аукционов: 50
* максимальное количество участников на аукционе: 10000
* среднее количество ставок на участника за аукцион: 10
* средняя длительность аукциона: 2 часа
* пиковое количество онлайн-пользователей (просмотр + участие): 50 * 10000 = 500 000
* качество видео: 720p, ~1.5 Мбит/с на пользователя

**Расчет трафика:**

* **Ставки:**
    * пиковая нагрузка: 500 000 участников * (10 ставок / 2 часа / 3600 сек) = 700 сообщений/сек (очень грубая оценка, пики могут быть выше). Тут требуется низкая задержка
* **Видеостриминг:**
    * пиковая нагрузка: 500 000 пользователей * 1.5 Мб/с = 750 000 Мб/с = 750 Гб/с. Требуется CDN или аналогичная инфраструктура, т.к. нагрузка имеет распределённый характер
* **API запросы (просмотр аукционов, профиль и т.д.):**
    * Если каждый активный пользователь делает 1 запрос каждые 30 секунд, то пиковая нагрузка: 500 000 пользователей / 30 сек = 17000 RPS

**Расчет нагрузки на БД:**

* **Запись:**
    * ставки: пик до ~700+ записей/сек
    * новые пользователи, обновления профилей, создание аукционов - не критично, т.к. на порядки менее интенсивно
* **Чтение:**
    * загрузка информации об аукционах: ~17000 RPS
    * чтение состояния аукциона - очень высокая частота, необходимо кэширование
* **Объем данных:**
    * пользователи: (например, 1 000 000 пользователей) * (1 МБ/пользователь) = 1 ТБ
    * аукционы и лоты: зависит от количества и описаний
    * история ставок: (1 000 000 пользователей * 50 ставок/год * 1 КБ/ставка) = ~50 ГБ/год
    * транзакции - аналогично истории ставок

**Выводы:**
* основные сложности - обработка ставок в реальном времени и видеостриминг для большого числа пользователей
* требуется масштабируемая распределённая архитектура (вероятно, микросервисная)
* необходимы механизмы кэширования для снижения нагрузки на БД
* видеостриминг потребует специализированной инфраструктуры (CDN)
* база данных должна быть выбрана с учетом смешанной нагрузки (транзакции + простое чтение)
* необходимо распределение по географическим зонам, т.к. пользователи могут быть из любого уголка страны и для них задержка будет сильно варьироваться в случае централизации

