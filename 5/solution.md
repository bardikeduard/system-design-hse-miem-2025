## HW: Базы данных

### 1. Выбор и обоснование СУБД

| Сервис | Сценарий использования | Выбор СУБД | Обоснование |
| :--- | :--- | :--- | :--- |
| Сервис пользователей | Хранение структурированных данных: профили, учетные данные, репутация. Требуются ACID-транзакции при регистрации и изменении данных. | PostgreSQL | РСУБД с гарантией ACID, подходит для хранения пользовательских данных. |
| Сервис аукционов | Хранение информации об аукционах, лотах, категориях. Данные структурированы, важна целостность. | PostgreSQL | Аналогично сервису пользователей, важна строгость и целостность данных. |
| Сервис поиска | Полнотекстовый поиск по названиям и описаниям аукционов, сложная фильтрация по множеству критериев. | Elasticsearch | Поисковый движок, созданный для быстрого поиска и агрегации. Обеспечивает лучшую производительность, относительно РСУБД в сценариях сложного поиска. |
| Сервис ставок | Хранение **только текущего состояния** аукциона: последняя ставка, лидер, время. Нужна очень быстрая запись и чтение с минимальной задержкой. | Redis Cluster | In-memory кеш, обеспечивающий минимальные задержки. Подойдёт для хранения горячих данных активных аукционов. |
| Сервис ставок | Долговременное хранение всей истории ставок для всех аукционов. Высокая интенсивность записи. Данные используются для аналитики и истории пользователя. | ClickHouse / Cassandra | ClickHouse - колоночная СУБД, подходит для аналитических запросов по большим объемам данных. Cassandra оптимизирована под огромный поток записей, что подходит для сохранения истории ставок. |
| Платежный сервис | Хранение финансовых транзакций, балансов пользователей. Требуется максимальная надежность и строгие гарантии ACID. | PostgreSQL | Нужны ACID-транзакции, которые предоставляет PostgreSQL, чтобы гарантировать корректность каждого платежа. |

### 2. Репликация и Шардирование

* PostgreSQL (сервисы пользователей, аукционов, платежный)
  * Репликация: используется стандартная схема с одной master-нодой и несколькими slave-нодами. Большинство операций в этих сервисах — это чтение (просмотр профиля, каталога аукционов). Read-реплики позволяют горизонтально масштабировать нагрузку на чтение и обеспечивают отказоустойчивость. Возможно также дополнительно повесить кеш на эти данные, чтобы снять часть нагрузки с БД.
  * Шардирование: на начальном этапе не требуется. В будущем, при росте до десятков миллионов пользователей, возможно шардирование сервиса пользователей, например, по `user_id`.

* Elasticsearch (сервис поиска)
  * Репликация и шардирование: поддерживаются из коробки. Индекс с аукционами разбивается на шарды, каждый из которых может иметь свои реплики на других узлах кластера. Это позволяет линейно наращивать производительность поиска и обеспечивает высокую доступность сервиса.

* Redis (сервис ставок)
  * Репликация и шардирование: используется кластер Redis. Он автоматически шардирует данные по разным узлам по ключу (например, `auction_id`). Это позволяет обрабатывать множество одновременных аукционов, распределяя нагрузку по всему кластеру.

* ClickHouse / Cassandra (история ставок)
  * Репликация и шардирование: данные автоматически распределяются и реплицируются по узлам кластера. Это позволяет системе выдерживать огромный поток записей (сохранение каждой ставки) и масштабироваться простым добавлением новых серверов в кластер.
